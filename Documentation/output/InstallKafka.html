<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <!--
      The Kafka Development Environment
 parameters will be replaced with the
      document title extracted from the <h1> element or
      file name, if there is no <h1> heading
    -->
    <title>Kafka Development Environment
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="http://code.jquery.com/jquery-1.8.0.js"></script>
    <script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet">
    <link type="text/css" rel="stylesheet" href="content/style.css" />
    <script src="content/tips.js" type="text/javascript"></script>
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>
<body>
    <div class="container">
        <div class="row" style="margin-top:30px">
            <div class="span1"></div>
            <div class="span10" id="main">
                <h1>Kafka Development Environment</h1>
<h2>Java Installation</h2>
<ol>
<li>Download and install <a href="http://www.oracle.com/technetwork/java/javase/downloads/jre8-downloads-2133155.html" title="Java Downloads">Java</a> (e.g. <code>jre1.8.0_91</code>)</li>
<li>
In System Properties -&gt; Environment Variables -&gt; System Variables
<ul>
<li>variable <code>JAVA_HOME</code> has value <code>C:\Program Files\Java\jre1.8.0_91</code></li>
<li>variable <code>PATH</code> contains value <code>C:\Program Files\Java\jre1.8.0_91</code></li>
</ul>
</li>
<li>Update these values each time you update the JRE</li>
<li>Restart Powershell and verify the <code>java -version</code></li>
</ol>
<h2>Zookeeper Installation</h2>
<ol>
<li>Download <a href="https://zookeeper.apache.org/releases.html#download" title="Apache Zookeeper Downloads">Zookeeper</a> (e.g. <code>3.4.8</code>)</li>
<li>Download <a href="https://nssm.cc" title="Non-Sucking Service Manager">nssm</a> for Windows.</li>
<li>Extract both to <code>C:\Program Files\Zookeeper\{bin,conf,etc}</code></li>
<li>
Change <code>C:\Program Files\Zookeeper\conf\zoo_sample.cfg</code> to <code>zoo.cfg</code>
<ul>
<li><code>dataDir=/ProgramData/Zookeeper</code></li>
<li><code>clientPortBindAddress=127.0.0.1</code> for a development workstation</li>
</ul>
</li>
<li>
Change <code>C:\Program Files\Zookeeper\bin\zkEnv.cmd</code>
<ul>
<li><code>set ZOO_LOG_DIR="C:\ProgramData\Zookeeper\logs"</code></li>
<li><code>set ZOO_LOG4J_PROP=INFO,CONSOLE,ROLLINGFILE</code></li>
</ul>
</li>
<li>Configure the Zookeeper service:</li>
</ol>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip"><code lang="powershell">nssm.exe install Zookeeper "C:\Program Files\Zookeeper\bin\zkServer.cmd"
</code></pre></td></tr></table>
<h2>Kafka Installation</h2>
<ol>
<li><p>Download <a href="http://kafka.apache.org/downloads.html" title="Apache Kafka Downloads">Kafka</a> (e.g. <code>2.11-0.9.0.1</code>)</p></li>
<li><p>Download <a href="https://nssm.cc" title="Non-Sucking Service Manager">nssm</a> for Windows.</p></li>
<li><p>Extract both to <code>C:\Program Files\Kafka\{bin,config,libs,etc}</code></p></li>
<li>
<p>Change <code>C:\Program Files\Kafka\config\server.properties</code></p>
<ul>
<li>
<p>for a development workstation:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="i">host</span><span class="o">.</span><span class="i">name</span><span class="o">=</span><span class="i">localhost</span>
<span class="i">zookeeper</span><span class="o">.</span><span class="i">connect</span><span class="o">=</span><span class="n">127.0</span><span class="o">.</span><span class="n">0.1</span><span class="o">:</span><span class="n">2181</span>
</code></pre></td>
</tr>
</table>
</li>
<li>
<p>customize defaults for event sourcing:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span onmouseout="hideTip(event, 'fs1', 1)" onmouseover="showTip(event, 'fs1', 1)" class="i">log</span><span class="o">.</span><span class="i">dir</span><span class="o">=/</span><span class="i">ProgramData</span><span class="o">/</span><span class="i">Kafka</span><span class="o">/</span><span class="i">data</span>
<span onmouseout="hideTip(event, 'fs1', 2)" onmouseover="showTip(event, 'fs1', 2)" class="i">log</span><span class="o">.</span><span class="i">retention</span><span class="o">.</span><span class="i">hours</span><span class="o">=-</span><span class="n">1</span>
<span onmouseout="hideTip(event, 'fs1', 3)" onmouseover="showTip(event, 'fs1', 3)" class="i">log</span><span class="o">.</span><span class="i">retention</span><span class="o">.</span><span class="i">bytes</span><span class="o">=-</span><span class="n">1</span>
<span onmouseout="hideTip(event, 'fs1', 4)" onmouseover="showTip(event, 'fs1', 4)" class="i">log</span><span class="o">.</span><span class="i">segment</span><span class="o">.</span><span class="i">bytes</span><span class="o">=</span><span class="n">104857600</span>
<span class="i">auto</span><span class="o">.</span><span class="i">create</span><span class="o">.</span><span class="i">topics</span><span class="o">.</span><span class="i">enable</span><span class="o">=</span><span class="k">true</span>
<span class="i">delete</span><span class="o">.</span><span class="i">topic</span><span class="o">.</span><span class="i">enable</span><span class="o">=</span><span class="k">true</span>
</code></pre></td>
</tr>
</table>
</li>
</ul>
</li>
<li>
<p>Change <code>C:\Program Files\Kafka\config\log4j.properties</code></p>
<ul>
<li><p><code>kafka.logs.dir=/ProgramData/Kafka/logs</code></p></li>
</ul>
</li>
<li>
<p>Change <code>C:\Program Files\Kafka\bin\windows\kafka-run-class.bat</code></p>
<ul>
<li>
<p><em>before:</em></p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="i">pushd</span> <span class="o">%~</span><span class="i">dp0</span><span class="o">..</span>
<span onmouseout="hideTip(event, 'fs2', 5)" onmouseover="showTip(event, 'fs2', 5)" class="i">set</span> <span class="i">BASE_DIR</span><span class="o">=%</span><span class="i">CD</span><span class="o">%</span>
<span class="i">popd</span>
</code></pre></td>
</tr>
</table>
</li>
<li>
<p><em>after:</em></p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span onmouseout="hideTip(event, 'fs2', 6)" onmouseover="showTip(event, 'fs2', 6)" class="i">set</span> <span class="i">BASE_DIR</span><span class="o">=/</span><span class="i">progra</span><span class="k">~</span><span class="n">1</span><span class="o">/</span><span class="i">kafka</span><span class="o">/</span>
</code></pre></td>
</tr>
</table>
</li>
</ul>
</li>
<li>
<p>Change <code>C:\Program Files\Kafka\bin\windows\kafka-server-start.bat</code></p>
<ul>
<li>
<p><em>before:</em></p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="i">SetLocal</span>
<span onmouseout="hideTip(event, 'fs2', 7)" onmouseover="showTip(event, 'fs2', 7)" class="i">set</span> <span class="i">KAFKA_LOG4J_OPTS</span><span class="o">=-</span><span class="i">Dlog4j</span><span class="o">.</span><span class="i">configuration</span><span class="o">=</span><span class="i">file</span><span class="o">:</span><span class="o">%~</span><span class="i">dp0</span><span class="o">.</span><span class="o">./../</span><span class="i">config</span><span class="o">/</span><span class="i">log4j</span><span class="o">.</span><span class="i">properties</span>
<span onmouseout="hideTip(event, 'fs2', 8)" onmouseover="showTip(event, 'fs2', 8)" class="i">set</span> <span class="i">KAFKA_HEAP_OPTS</span><span class="o">=-</span><span class="i">Xmx1G</span> <span class="o">-</span><span class="i">Xms1G</span>
<span class="o">%~</span><span class="i">dp0kafka</span><span class="o">-</span><span class="i">run</span><span class="o">-</span><span class="k">class</span><span class="o">.</span><span class="i">bat</span> <span class="i">kafka</span><span class="o">.</span><span class="i">Kafka</span> <span class="o">%*</span>
<span class="i">EndLocal</span>
</code></pre></td>
</tr>
</table>
</li>
<li>
<p><em>after:</em></p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="i">SetLocal</span>
<span onmouseout="hideTip(event, 'fs2', 9)" onmouseover="showTip(event, 'fs2', 9)" class="i">set</span> <span class="i">KAFKA_LOG4J_OPTS</span><span class="o">=-</span><span class="i">Dlog4j</span><span class="o">.</span><span class="i">configuration</span><span class="o">=</span><span class="i">file</span><span class="o">:</span><span class="o">/</span><span class="i">progra</span><span class="k">~</span><span class="n">1</span><span class="o">/</span><span class="i">kafka</span><span class="o">/</span><span class="i">config</span><span class="o">/</span><span class="i">log4j</span><span class="o">.</span><span class="i">properties</span>
<span onmouseout="hideTip(event, 'fs2', 10)" onmouseover="showTip(event, 'fs2', 10)" class="i">set</span> <span class="i">KAFKA_HEAP_OPTS</span><span class="o">=-</span><span class="i">Xmx1G</span> <span class="o">-</span><span class="i">Xms1G</span>
<span class="o">/</span><span class="i">progra</span><span class="k">~</span><span class="n">1</span><span class="o">/</span><span class="i">kafka</span><span class="o">/</span><span class="i">bin</span><span class="o">/</span><span class="i">windows</span><span class="o">/</span><span class="i">kafka</span><span class="o">-</span><span class="i">run</span><span class="o">-</span><span class="k">class</span><span class="o">.</span><span class="i">bat</span> <span class="i">kafka</span><span class="o">.</span><span class="i">Kafka</span> <span class="o">%*</span>
<span class="i">EndLocal</span>
</code></pre></td>
</tr>
</table>
</li>
<li>
<p>Similar changes can also be made to the following:</p>
<ul>
<li><p><code>kafka-console-consumer.bat</code></p></li>
<li><p><code>kafka-console-producer.bat</code></p></li>
<li><p><code>kafka-topics.bat</code></p></li>
</ul>
</li>
</ul>
</li>
<li>Configure the Kafka service:</li>
</ol>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip"><code lang="powershell">nssm.exe install Kafka "c:\progra~1\kafka\bin\windows\kafka-server-start.bat" \progra~1\kafka\config\server.properties
</code></pre></td></tr></table>
<h2>Life-cycle</h2>
<ol>
<li>
<p>Start Zookeeper before Kafka</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="i">net</span> <span class="i">start</span> <span class="i">zookeeper</span>
<span class="i">net</span> <span class="i">start</span> <span class="i">kafka</span>
</code></pre></td>
</tr>
</table>
</li>
<li>
<p>Monitor Log Entries (using <code>baretail</code> or <code>cat</code>)</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="i">cat</span> <span class="o">-</span><span class="i">wait</span> <span class="s">&quot;C:\ProgramData\Zookeeper\logs\zookeeper.log&quot;</span>
<span class="i">cat</span> <span class="o">-</span><span class="i">wait</span> <span class="s">&quot;C:\ProgramData\Kafka\logs\controller.log&quot;</span>
<span class="i">cat</span> <span class="o">-</span><span class="i">wait</span> <span class="s">&quot;C:\ProgramData\Kafka\logs\kafka-authorizer.log&quot;</span>
<span class="i">cat</span> <span class="o">-</span><span class="i">wait</span> <span class="s">&quot;C:\ProgramData\Kafka\logs\kafka-request.log&quot;</span>
<span class="i">cat</span> <span class="o">-</span><span class="i">wait</span> <span class="s">&quot;C:\ProgramData\Kafka\logs\log-cleaner.log&quot;</span>
<span class="i">cat</span> <span class="o">-</span><span class="i">wait</span> <span class="s">&quot;C:\ProgramData\Kafka\logs\state-change.log&quot;</span>
<span class="i">cat</span> <span class="o">-</span><span class="i">wait</span> <span class="s">&quot;C:\ProgramData\Kafka\logs\server.log&quot;</span>
</code></pre></td>
</tr>
</table>
</li>
<li>
<p>Data is stored in <code>C:\ProgramData\Kafka\data</code></p>
<ul>
<li><p>Produce events for the broker @ <code>tcp://127.0.0.1:9092</code></p></li>
<li><p>Consume events from zookeeper @ <code>127.0.0.1:8081</code></p></li>
</ul>
</li>
<li>
<p>Stop Kafka before Zookeeper</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="i">net</span> <span class="i">stop</span> <span class="i">kafka</span>
<span class="i">net</span> <span class="i">stop</span> <span class="i">zookeeper</span>
</code></pre></td>
</tr>
</table>
</li>
<li>
<p>Reset Data</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="i">rm</span> <span class="o">-</span><span class="i">recurse</span> <span class="s">&quot;C:\ProgramData\Kafka\data\*&quot;</span>
<span class="i">rm</span> <span class="o">-</span><span class="i">recurse</span> <span class="s">&quot;C:\ProgramData\Zookeeper\version-2\*&quot;</span>
</code></pre></td>
</tr>
</table>
</li>
</ol>

                <div class="tip" id="fs1">val log : value:&#39;T -&gt; &#39;T (requires member Log)<br /><br />Full name: Microsoft.FSharp.Core.Operators.log</div>
<div class="tip" id="fs2">val set : elements:seq&lt;&#39;T&gt; -&gt; Set&lt;&#39;T&gt; (requires comparison)<br /><br />Full name: Microsoft.FSharp.Core.ExtraTopLevelOperators.set</div>

            </div>
            <div class="span1"></div>
        </div>
    </div>
</body>
</html>